# åä¸œå¸ˆèŒƒå¤§å­¦ESIå­¦ç§‘æ’ååˆ†æå®éªŒæŠ¥å‘Š

## å®éªŒæ¦‚è¿°

### å®éªŒç›®çš„
æœ¬å®éªŒæ—¨åœ¨é€šè¿‡è‡ªåŠ¨åŒ–çˆ¬è™«æŠ€æœ¯è·å–Clarivate ESIæ•°æ®åº“ä¸­çš„å…¨çƒå¤§å­¦æ’åæ•°æ®ï¼Œé‡ç‚¹åˆ†æåä¸œå¸ˆèŒƒå¤§å­¦åœ¨å„å­¦ç§‘é¢†åŸŸçš„å…¨çƒè¡¨ç°ï¼Œä¸ºå­¦ç§‘å»ºè®¾æä¾›æ•°æ®æ”¯æŒã€‚

### å®éªŒç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Windows 11
- **ç¼–ç¨‹è¯­è¨€**: Python 3.13
- **æ ¸å¿ƒå·¥å…·åº“**: Selenium, Pandas, Matplotlib
- **æµè§ˆå™¨**: Microsoft Edge
- **æ•°æ®æº**: Clarivate ESI Indicatorsæ•°æ®åº“

## ä¸€ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 1.1 ç³»ç»Ÿæ•´ä½“æ¶æ„

```
çˆ¬è™«æ§åˆ¶å™¨ (Main)
    â†“
æµè§ˆå™¨é©±åŠ¨å±‚ (Selenium WebDriver)
    â†“
é¡µé¢äº¤äº’å±‚ (å…ƒç´ å®šä½ä¸æ“ä½œ)
    â†“
æ•°æ®å¤„ç†å±‚ (æ•°æ®è§£æä¸åˆ†æ)
    â†“
æŠ¥å‘Šç”Ÿæˆå±‚ (å¯è§†åŒ–ä¸æŠ¥å‘Šè¾“å‡º)
```

### 1.2 æ ¸å¿ƒæŠ€æœ¯é€‰å‹ç†ç”±

é€‰æ‹©Selenium WebDriverä½œä¸ºæ ¸å¿ƒè‡ªåŠ¨åŒ–å·¥å…·çš„ä¸»è¦åŸå› ï¼š
- **åŠ¨æ€å†…å®¹å¤„ç†**: ESIç½‘ç«™å¤§é‡ä½¿ç”¨JavaScriptåŠ¨æ€åŠ è½½
- **å¤æ‚äº¤äº’æ”¯æŒ**: éœ€è¦å¤„ç†å¤šå±‚å¼¹å‡ºèœå•å’Œç­›é€‰å™¨
- **ç¨³å®šæ€§**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼Œé¿å…è¢«åçˆ¬æœºåˆ¶æ‹¦æˆª

## äºŒã€çˆ¬è™«ç³»ç»Ÿå…³é”®æŠ€æœ¯å®ç°

### 2.1 æµè§ˆå™¨è‡ªåŠ¨åŒ–åˆå§‹åŒ–

```python
def init_edge_browser():
    # é…ç½®Edgeæµè§ˆå™¨é€‰é¡¹
    edge_options = webdriver.EdgeOptions()
    edge_options.binary_location = EDGE_PATH
    edge_options.add_argument("--start-maximized")
    edge_options.add_experimental_option("prefs", {
        "download.default_directory": os.path.abspath(DOWNLOAD_DIR),
        "download.prompt_for_download": False,  # ç¦ç”¨ä¸‹è½½ç¡®è®¤å¯¹è¯æ¡†
        "download.directory_upgrade": True,
        "safebrowsing.enabled": True
    })
```

**æŠ€æœ¯è¦ç‚¹**:
- é¢„è®¾ä¸‹è½½è·¯å¾„å®ç°æ–‡ä»¶è‡ªåŠ¨ç®¡ç†
- ç¦ç”¨ä¸‹è½½ç¡®è®¤å¯¹è¯æ¡†ç¡®ä¿æµç¨‹è‡ªåŠ¨åŒ–
- ä½¿ç”¨Cookieè®¤è¯ç»´æŒç™»å½•çŠ¶æ€

### 2.2 æ™ºèƒ½å…ƒç´ å®šä½ç³»ç»Ÿ

#### 2.2.1 å¤šç­–ç•¥å®šä½æœºåˆ¶

é¢å¯¹ESIç½‘ç«™å¤æ‚çš„åŠ¨æ€ç•Œé¢ï¼Œè®¾è®¡äº†åˆ†å±‚å®šä½ç­–ç•¥ï¼š

```python
# å¼¹å‡ºèœå•è¯†åˆ«ç­–ç•¥
popup_selectors = [
    "#popupFilter",  # æ ‡å‡†IDé€‰æ‹©å™¨
    "//div[contains(@class, 'popup') and contains(@style, 'display: block')]",
    "//div[contains(@class, 'dropdown-menu') and contains(@style, 'display: block')]",
    "//div[contains(@class, 'select2-drop')]"
]

# é€‰æ‹©æœ€å¤§å¯è§å…ƒç´ ä½œä¸ºç›®æ ‡å¼¹å‡ºèœå•
popup_filter = max(visible_elements, key=lambda x: x.size['width'] * x.size['height'])
```

#### 2.2.2 å­¦ç§‘å¤é€‰æ¡†å®šä½ç®—æ³•

é’ˆå¯¹å­¦ç§‘é€‰æ‹©ç•Œé¢çš„ç‰¹æ®Šéœ€æ±‚ï¼Œå®ç°å¤šå±‚çº§å®šä½ï¼š

```python
checkbox_strategies = [
    # ç²¾ç¡®valueåŒ¹é…
    (f".//input[@type='checkbox' and @value='{field_name}']", "valueå±æ€§"),
    # æ–‡æœ¬æ ‡ç­¾å…³è”
    (f".//label[normalize-space()='{field_name}']/preceding-sibling::input", "labelæ–‡æœ¬"),
    # éƒ¨åˆ†åŒ¹é…ç­–ç•¥
    (f".//input[@type='checkbox' and contains(@value, 'Biology')]", "éƒ¨åˆ†åŒ¹é…")
]
```



### 2.3 é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶

å»ºç«‹ä¸‰çº§é‡è¯•æœºåˆ¶ç¡®ä¿ç³»ç»Ÿå¥å£®æ€§ï¼š

```python
for retry in range(RETRY_TIMES + 1):
    try:
        # ä¸»è¦ä¸šåŠ¡é€»è¾‘
        if operation_success:
            break
    except Exception as e:
        if retry < RETRY_TIMES:
            print(f"ğŸ”„ é‡è¯•ç¬¬{retry+1}æ¬¡...")
            time.sleep(3)
            clear_existing_filters(driver)  # é‡ç½®çŠ¶æ€
            continue
```

## ä¸‰ã€å…³é”®ä¸šåŠ¡æµç¨‹å®ç°

### 3.1 å­¦ç§‘ç­›é€‰æµç¨‹æ§åˆ¶

```
å¼€å§‹
  â†“
æ¸…é™¤å†å²ç­›é€‰æ¡ä»¶
  â†“
é€‰æ‹©Institutionsåˆ†ç»„æ¨¡å¼
  â†“
ç‚¹å‡»Add FilteræŒ‰é’®
  â†“
è¯†åˆ«å¼¹å‡ºèœå• â†’ [å¤±è´¥] â†’ é‡è¯•æœºåˆ¶
  â†“
é€‰æ‹©Research Fieldsé€‰é¡¹
  â†“
è¿›å…¥å­¦ç§‘é€‰æ‹©ç•Œé¢
  â†“
å®šä½ç›®æ ‡å­¦ç§‘å¤é€‰æ¡† â†’ [å¤±è´¥] â†’ å¤šç­–ç•¥å®šä½
  â†“
é€‰ä¸­å¤é€‰æ¡†å¹¶è¿”å›
  â†“
åº”ç”¨ç­›é€‰æ¡ä»¶
  â†“
éªŒè¯ç­›é€‰ç»“æœ
  â†“
ç»“æŸ
```

### 3.2 æ•°æ®ä¸‹è½½è‡ªåŠ¨åŒ–

```python
def download_field_data(driver, field_name):
    # è§¦å‘ä¸‹è½½æŒ‰é’®
    export_btn = driver.find_element(By.CLASS_NAME, "action-download")
    driver.execute_script("arguments[0].click();", export_btn)
    
    # è¯†åˆ«ä¸‹è½½é€‰é¡¹å¼¹å‡ºçª—å£
    download_popup = locate_download_popup(driver)
    csv_option = download_popup.find_element(By.ID, "expCsvBtn")
    driver.execute_script("arguments[0].click();", csv_option)
    
    # ç­‰å¾…ä¸‹è½½å®Œæˆå¹¶éªŒè¯
    time.sleep(8)
    return verify_download_complete()
```
ğŸ‰ æ‰€æœ‰å­¦ç§‘å¤„ç†å®Œæˆï¼æ•°æ®è·¯å¾„ï¼šC:\Users\PPT\database\esi_institution_rankings
![æ–‡ä»¶æ•°æ®è¾“å‡ºæˆªå›¾](./æ–‡ä»¶æ•´åˆ.png)
![çˆ¬è™«ç¨‹åºè¾“å‡ºæˆªå›¾](./lab3.png)
*å›¾3-1 çˆ¬è™«ç¨‹åºè‡ªåŠ¨åŒ–æ“ä½œESIç½‘ç«™ç•Œé¢*

## å››ã€æ•°æ®å¤„ç†ä¸åˆ†ææŠ€æœ¯

### 4.1 æ•°æ®è§£æç­–ç•¥

#### 4.1.1 å­¦ç§‘åç§°å‡†ç¡®æå–

ä»CSVæ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ä¸­æå–å‡†ç¡®çš„å­¦ç§‘åç§°ï¼Œé¿å…ä¾èµ–æ–‡ä»¶åï¼š

```python
def parse_esi_csv_accurate(file_path):
    # è¯»å–æ–‡ä»¶ç¬¬ä¸€è¡Œè·å–å­¦ç§‘ä¿¡æ¯
    with open(file_path, 'r', encoding='latin-1') as f:
        first_line = f.readline().strip()
    
    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å­¦ç§‘åç§°
    field_match = re.search(r'Filter Value\(s\):\s*([^&]+?)\s*Show:', first_line)
    research_field = field_match.group(1).strip() if field_match else "Unknown"
```

#### 4.1.2 åä¸œå¸ˆèŒƒå¤§å­¦æ’åè¯†åˆ«

é€šè¿‡ç²¾ç¡®çš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•å®šä½ç›®æ ‡æœºæ„ï¼š

```python
target_university = "EAST CHINA NORMAL UNIVERSITY"
ecnu_mask = df['Institution'].astype(str).str.contains(target_university, case=False, na=False)
ecnu_data = df[ecnu_mask].copy()
```

### 4.2 å¯è§†åŒ–åˆ†ææŠ€æœ¯

#### 4.2.1 æ’åæ°´å¹³åˆ†çº§ä½“ç³»

å»ºç«‹ç§‘å­¦çš„å››çº§åˆ†ç±»æ ‡å‡†ï¼š
- **ä¸–ç•Œä¸€æµ**: å…¨çƒå‰100å
- **å›½é™…çŸ¥å**: 101-200å
- **æœ‰ç«äº‰åŠ›**: 201-500å  
- **æœ‰å½±å“åŠ›**: 500åä»¥ä¸Š

#### 4.2.2 å¤šç»´åº¦å¯è§†åŒ–

```python
# åˆ›å»ºæ°´å¹³æ¡å½¢å›¾å±•ç¤ºæ’ååˆ†å¸ƒ
plt.figure(figsize=(14, 10))
colors = ['#FF6B6B' if rank <= 100 else '#4ECDC4' if rank <= 200 else '#45B7D1' for rank in ranks]
bars = plt.barh(range(len(data)), ranks, color=colors, alpha=0.8)
```

![å®éªŒæŠ¥å‘Š1](./å®éªŒæŠ¥å‘Š1.png)
![å®éªŒæŠ¥å‘Š2](./å®éªŒæŠ¥å‘Š2.png)
![ä¸“ä¸šæ•°æ®çƒ­åŠ›å›¾](./major_heatmap.png)
![ä¸“ä¸šæ’ååˆ†å¸ƒ](./major_ranking.png)
![ç§‘ç ”äº§å‡ºå½±å“åŠ›](./major_scatter.png)


## äº”ã€æŠ€æœ¯éš¾ç‚¹ä¸åˆ›æ–°è§£å†³æ–¹æ¡ˆ

### 5.1 åŠ¨æ€é¡µé¢äº¤äº’æŒ‘æˆ˜

**é—®é¢˜**: ESIç½‘ç«™ä½¿ç”¨å¤§é‡JavaScriptåŠ¨æ€ç”Ÿæˆç•Œé¢å…ƒç´ ï¼Œä¼ ç»Ÿå®šä½æ–¹æ³•å¤±æ•ˆã€‚

**è§£å†³æ–¹æ¡ˆ**: 
- å®ç°åŸºäºå…ƒç´ ç‰¹å¾çš„å¯è§†åŒ–è¯†åˆ«ç®—æ³•
- ä½¿ç”¨æ˜¾å¼ç­‰å¾…(WebDriverWait)ç¡®ä¿å…ƒç´ åŠ è½½å®Œæˆ
- å»ºç«‹å…ƒç´ çŠ¶æ€éªŒè¯æœºåˆ¶

### 5.2 å¤æ‚èœå•å¯¼èˆªé—®é¢˜

**é—®é¢˜**: å¤šå±‚å¼¹å‡ºèœå•å’ŒåŠ¨æ€å†…å®¹å¯¼è‡´å¯¼èˆªæµç¨‹å¤æ‚ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- è®¾è®¡çŠ¶æ€æœºæ¨¡å‹ç®¡ç†ä¸šåŠ¡æµç¨‹
- å®ç°æ™ºèƒ½çš„å…ƒç´ å‘ç°å’Œäº¤äº’ç­–ç•¥
- å»ºç«‹å¼‚å¸¸çŠ¶æ€æ£€æµ‹å’Œæ¢å¤æœºåˆ¶

### 5.3 æ•°æ®ä¸€è‡´æ€§ä¿éšœ

**é—®é¢˜**: ä¸åŒå­¦ç§‘çš„æ•°æ®æ ¼å¼å’Œç»“æ„å­˜åœ¨å·®å¼‚ã€‚

**è§£å†³æ–¹æ¡ˆ**:
- è®¾è®¡è‡ªé€‚åº”çš„æ•°æ®è§£æç®—æ³•
- å®ç°æ•°æ®è´¨é‡éªŒè¯æ£€æŸ¥
- å»ºç«‹é”™è¯¯æ•°æ®å¤„ç†å’Œæ—¥å¿—è®°å½•

## å…­ã€ç³»ç»Ÿæ€§èƒ½ä¸æ•ˆæœè¯„ä¼°

### 6.1 è¿è¡Œæ•ˆç‡ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| æ€»è¿è¡Œæ—¶é—´ | ~45åˆ†é’Ÿ | å¤„ç†22ä¸ªå­¦ç§‘ |
| å¹³å‡æ¯å­¦ç§‘ | ~2åˆ†é’Ÿ | åŒ…æ‹¬ç­›é€‰å’Œä¸‹è½½ |
| æˆåŠŸç‡ | 100% | æ‰€æœ‰å­¦ç§‘å®Œæ•´ä¸‹è½½ |
| å†…å­˜å ç”¨ | 200-300MB | ç¨³å®šè¿è¡Œ |

### 6.2 æ•°æ®è´¨é‡è¯„ä¼°

- **æ•°æ®å®Œæ•´æ€§**: 22ä¸ªå­¦ç§‘å…¨éƒ¨æˆåŠŸè·å–
- **å‡†ç¡®æ€§**: å­¦ç§‘åç§°ç›´æ¥ä»æ•°æ®æºæå–ï¼Œç¡®ä¿å‡†ç¡®
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„è§£æé€»è¾‘ä¿è¯æ•°æ®æ ¼å¼ä¸€è‡´

## ä¸ƒã€æŠ€æœ¯åˆ›æ–°ç‚¹æ€»ç»“

### 7.1 æ ¸å¿ƒæŠ€æœ¯çªç ´

1. **æ™ºèƒ½å…ƒç´ å®šä½ç³»ç»Ÿ**: å¤šç­–ç•¥èåˆåº”å¯¹åŠ¨æ€é¡µé¢æŒ‘æˆ˜
2. **åˆ†å±‚é”™è¯¯æ¢å¤æœºåˆ¶**: ä¸‰çº§é‡è¯•ä¿éšœç³»ç»Ÿå¥å£®æ€§
3. **è‡ªé€‚åº”æ•°æ®è§£æ**: å¤„ç†ä¸åŒæ ¼å¼çš„æ•°æ®æ–‡ä»¶
4. **å…¨æµç¨‹è‡ªåŠ¨åŒ–**: ä»æ•°æ®é‡‡é›†åˆ°æŠ¥å‘Šç”Ÿæˆçš„å®Œæ•´æµæ°´çº¿

### 7.2 å·¥ç¨‹å®è·µä»·å€¼

1. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºç»´æŠ¤å’Œæ‰©å±•
2. **å¯é…ç½®æ€§**: å…³é”®å‚æ•°å¤–éƒ¨åŒ–é…ç½®
3. **å¯ç§»æ¤æ€§**: æŠ€æœ¯æ¡†æ¶å¯è¿ç§»åˆ°å…¶ä»–ç±»ä¼¼åœºæ™¯
4. **æ–‡æ¡£å®Œæ•´æ€§**: è¯¦ç»†çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£è¯´æ˜

## å…«ã€åº”ç”¨å‰æ™¯ä¸æ‰©å±•æ–¹å‘

### 8.1 æŠ€æœ¯åº”ç”¨æ‰©å±•

- **å¤šå¹³å°æ”¯æŒ**: æ‰©å±•æ”¯æŒChromeã€Firefoxç­‰æµè§ˆå™¨
- **åˆ†å¸ƒå¼çˆ¬è™«**: å®ç°å¤šå®ä¾‹å¹¶è¡Œæ•°æ®é‡‡é›†
- **å®æ—¶ç›‘æ§**: å¢åŠ è¿è¡ŒçŠ¶æ€ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

### 8.2 ä¸šåŠ¡åŠŸèƒ½å¢å¼º

- **è¶‹åŠ¿åˆ†æ**: å¢åŠ å†å²æ•°æ®å¯¹æ¯”å’Œè¶‹åŠ¿é¢„æµ‹
- **å¯¹æ¯”åˆ†æ**: æ”¯æŒå¤šæ‰€é«˜æ ¡çš„æ¨ªå‘å¯¹æ¯”
- **è‡ªå®šä¹‰æŠ¥å‘Š**: æä¾›å¯å®šåˆ¶çš„åˆ†ææŠ¥å‘Šæ¨¡æ¿

## å®éªŒæ€»ç»“

æœ¬å®éªŒæˆåŠŸæ„å»ºäº†ä¸€ä¸ªç¨³å®šå¯é çš„ESIæ•°æ®è‡ªåŠ¨åŒ–é‡‡é›†ä¸åˆ†æç³»ç»Ÿï¼Œä¸»è¦æŠ€æœ¯æˆæœåŒ…æ‹¬ï¼š

1. **æ”»å…‹äº†åŠ¨æ€Webåº”ç”¨çš„è‡ªåŠ¨åŒ–æŒ‘æˆ˜**ï¼Œå®ç°äº†å¤æ‚äº¤äº’æµç¨‹çš„å¯é æ‰§è¡Œ
2. **å»ºç«‹äº†å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶**ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨å¼‚å¸¸æƒ…å†µä¸‹çš„æŒç»­è¿è¡Œ
3. **è®¾è®¡äº†æ™ºèƒ½çš„æ•°æ®è§£æç®—æ³•**ï¼Œä¿è¯æ•°æ®è´¨é‡å’Œå‡†ç¡®æ€§
4. **å®ç°äº†ç«¯åˆ°ç«¯çš„è‡ªåŠ¨åŒ–æµæ°´çº¿**ï¼Œä»æ•°æ®é‡‡é›†åˆ°åˆ†ææŠ¥å‘Šçš„å…¨æµç¨‹è¦†ç›–

è¯¥ç³»ç»Ÿä¸ä»…ä¸ºåä¸œå¸ˆèŒƒå¤§å­¦çš„å­¦ç§‘å»ºè®¾æä¾›äº†æœ‰ä»·å€¼çš„æ•°æ®æ”¯æŒï¼Œå…¶æŠ€æœ¯æ¡†æ¶å’Œè§£å†³æ–¹æ¡ˆä¹Ÿå…·æœ‰å¾ˆå¥½çš„é€šç”¨æ€§å’Œæ¨å¹¿ä»·å€¼ï¼Œå¯åº”ç”¨äºå…¶ä»–ç±»ä¼¼çš„å­¦æœ¯æ•°æ®è‡ªåŠ¨åŒ–å¤„ç†åœºæ™¯ã€‚

---
**å®éªŒå®Œæˆæ—¶é—´**: 2025å¹´1æœˆ11æ—¥  
**æŠ€æœ¯å®ç°**: Python + Seleniumè‡ªåŠ¨åŒ–çˆ¬è™«  
**æ•°æ®åˆ†æ**: Pandas + Matplotlib  
